name: Fix Backslash Paths v2

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  fix_paths:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Normalize filenames with backslashes and quotes
        run: |
          echo "üîß Scanning and fixing backslash paths..."
          git ls-files | grep '\\\\' || echo "No files found with backslashes."

          git ls-files | grep '\\\\' | while read raw; do
            # Hapus tanda kutip dan escape dari nama file
            clean=$(echo "$raw" | sed 's/^"//' | sed 's/"$//' | sed 's/\\\\/\\//g')
            fixed=$(echo "$clean" | sed 's#\\#/#g')
            echo "üß© Fixing: $raw  ‚Üí  $fixed"
            mkdir -p "$(dirname "$fixed")" || true
            mv "$clean" "$fixed" 2>/dev/null || mv "$raw" "$fixed" 2>/dev/null || echo "‚ö†Ô∏è Skip: $raw"
          done

          echo "‚úÖ Path normalization finished."

      - name: Commit and push renamed files
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Fix backslash filenames (normalize escaped Windows paths)"
          branch: master
