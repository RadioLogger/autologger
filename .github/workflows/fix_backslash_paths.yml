name: Fix Backslash Paths v3

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  fix_paths:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Fix Windows-style backslashes safely
        run: |
          echo "üîß Scanning and fixing backslash paths..."
          # Cari semua file yang punya backslash di nama
          git ls-files | grep '\\\\' || echo "No files with backslashes found."
          
          git ls-files | grep '\\\\' | while read raw; do
            # Hapus tanda kutip di awal/akhir
            clean=$(echo "$raw" | tr -d '"')
            # Ganti backslash (\) menjadi slash (/)
            fixed=$(echo "$clean" | awk '{gsub(/\\/, "/"); print}')
            
            echo "üß© Fixing: $clean  ‚Üí  $fixed"
            
            mkdir -p "$(dirname "$fixed")" || true
            # Coba pindahkan file jika ada
            if [ -f "$clean" ]; then
              mv "$clean" "$fixed"
            elif [ -f "$raw" ]; then
              mv "$raw" "$fixed"
            else
              echo "‚ö†Ô∏è File not found: $clean"
            fi
          done

          echo "‚úÖ All paths normalized successfully."

      - name: Commit and push renamed files
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Normalize Windows backslash filenames to Unix-style folders"
          branch: master
